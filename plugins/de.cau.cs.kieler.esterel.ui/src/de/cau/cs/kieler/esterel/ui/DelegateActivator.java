/*
 * generated by Xtext
 */
package de.cau.cs.kieler.esterel.ui;

import java.util.Collections;
import java.util.Map;

import org.apache.log4j.Logger;
import org.eclipse.ui.plugin.AbstractUIPlugin;
import org.eclipse.xtext.ui.shared.SharedStateModule;
import org.eclipse.xtext.util.Modules2;
import org.osgi.framework.BundleContext;

import com.google.common.collect.Maps;
import com.google.inject.Guice;
import com.google.inject.Injector;
import com.google.inject.Module;

import de.cau.cs.kieler.esterel.scest.ui.internal.SCEstActivator;
import de.cau.cs.kieler.esterel.ui.internal.EsterelActivator;

/**
 * Delegate Activator for Esterel and SCEst.
 */
public class DelegateActivator extends AbstractUIPlugin {
	
	public static final String DE_CAU_CS_KIELER_ESTEREL = "de.cau.cs.kieler.esterel";
	
	private static final Logger logger = Logger.getLogger(DelegateActivator.class);
	
	private static DelegateActivator INSTANCE;
	
	private Map<String, Injector> injectors = Collections.synchronizedMap(Maps.<String, Injector> newHashMapWithExpectedSize(1));
	
	
	@Override
	public void start(BundleContext context) throws Exception {
		super.start(context);
		INSTANCE = this;
		new EsterelActivator().start(context);
		new SCEstActivator().start(context);
	}
	
	@Override
	public void stop(BundleContext context) throws Exception {
	    EsterelActivator.getInstance().stop(context);
	    SCEstActivator.getInstance().stop(context);
		injectors.clear();
		INSTANCE = null;
		super.stop(context);
	}
	
	public static DelegateActivator getInstance() {
		return INSTANCE;
	}
	
	public Injector getInjector(String language) {
        if (EsterelActivator.DE_CAU_CS_KIELER_ESTEREL_ESTEREL.equals(language)) {
            return EsterelActivator.getInstance().getInjector(language);
        }
        if (SCEstActivator.DE_CAU_CS_KIELER_ESTEREL_SCEST_SCEST.equals(language)) {
            return SCEstActivator.getInstance().getInjector(language);
        }
        
        throw new IllegalArgumentException(language); 
	}

	protected Module getRuntimeModule(String grammar) {
		if (EsterelActivator.DE_CAU_CS_KIELER_ESTEREL_ESTEREL.equals(grammar)) {
			return new de.cau.cs.kieler.esterel.EsterelRuntimeModule();
		}
		if (SCEstActivator.DE_CAU_CS_KIELER_ESTEREL_SCEST_SCEST.equals(grammar)) {
            return new de.cau.cs.kieler.esterel.scest.SCEstRuntimeModule();
        }
		
		throw new IllegalArgumentException(grammar);
	}
	
	protected Module getUiModule(String grammar) {
		if (EsterelActivator.DE_CAU_CS_KIELER_ESTEREL_ESTEREL.equals(grammar)) {
			return new de.cau.cs.kieler.esterel.ui.EsterelUiModule(this);
		}
		if (SCEstActivator.DE_CAU_CS_KIELER_ESTEREL_SCEST_SCEST.equals(grammar)) {
            return new de.cau.cs.kieler.esterel.scest.ui.SCEstUiModule(this);
        }
		
		throw new IllegalArgumentException(grammar);
	}
	
	protected Module getSharedStateModule() {
		return new SharedStateModule();
	}
	
}
